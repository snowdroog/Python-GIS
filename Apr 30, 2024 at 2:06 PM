# Assume 'data' is your dataframe from Spotfire
data <- GENSCAPE_PIPEFLOW_REPORTS

# Step 1: Calculate the average of the top 10 production values per region
average_top_10 <- by(data$production, data$REGION, function(x) {
  top_values <- tail(sort(x), 10)  # Sort and take the top 10
  mean(top_values)  # Calculate the average
})

# Transform the result into a dataframe
average_top_10 <- data.frame(REGION = names(average_top_10), AverageTop10 = as.vector(average_top_10))

# Step 2: Generate a table of production by day for all regions using the average
# Creating a sequence of dates from today to the end of the current year
end_of_year <- as.Date(paste(year(Sys.Date()), "12", "31", sep="-"))
days_to_end_of_year <- seq.Date(from = Sys.Date(), to = end_of_year, by = "day")

# Creating the final table
daily_production_by_region <- expand.grid(Date = days_to_end_of_year, REGION = unique(data$REGION))
daily_production_by_region <- merge(daily_production_by_region, average_top_10, by = "REGION", all.x = TRUE)

# Setting the production to the calculated average for each region
daily_production_by_region$Production <- daily_production_by_region$AverageTop10

# Output the final table
daily_production_by_region